[TOC]



## 1. action ç¼ºç‚¹

action åœ¨ **å…±äº«** è¿™æ–¹é¢ï¼Œåªèƒ½é  **å¤åˆ¶** è¿™ä¸€æ‰‹æ®µï¼Œç›¸å½“ä¹‹ä¸ä¼˜é›…



## 2. plugin åŸºæœ¬æ“ä½œ

### 1. åˆ—å‡ºæ‰€æœ‰ å¯ç”¨ plugin

```
fastlane search_plugins
```

### 2. æœç´¢ æŒ‡å®šåç§°çš„ plugin

```
fastlane search_plugins [plugin_name]
```

### 3. æ·»åŠ  plugin

```
fastlane add_plugin [name]
```

### 4. å®‰è£… plugin

```
fastlane install_plugins
```



## 3. å®‰è£…ä½¿ç”¨ è’²å…¬è‹± plugin

### 1. è¿›å…¥ iOS é¡¹ç›® æ ¹ç›®å½•

```
âœ  Book ls
Book           Book.xcodeproj Gemfile        Gemfile.lock   fastlane
âœ  Book
```

### 2. fastlane init

```
âœ  Book fastlane init
[âœ”] ğŸš€
[âœ”] Looking for iOS and Android projects in current directory...
[17:14:52]: Created new folder './fastlane'.
[17:14:52]: Detected an iOS/macOS project in the current directory: 'Book.xcodeproj'
[17:14:52]: -----------------------------
[17:14:52]: --- Welcome to fastlane ğŸš€ ---
[17:14:52]: -----------------------------
[17:14:52]: fastlane can help you with all kinds of automation for your mobile app
[17:14:52]: We recommend automating one task first, and then gradually automating more over time
[17:14:52]: What would you like to use fastlane for?
1. ğŸ“¸  Automate screenshots
2. ğŸ‘©â€âœˆï¸  Automate beta distribution to TestFlight
3. ğŸš€  Automate App Store distribution
4. ğŸ›   Manual setup - manually setup your project to automate your tasks
?  4
............................
............................
............................
[17:15:40]: To try your new fastlane setup, just enter and run
[17:15:40]: $ fastlane custom_lane
âœ  Book
```

### 3. å®‰è£… ==è’²å…¬è‹±== fastlen plugin

> bundle exec fastlane add_plugin pgyer

```
 ~/collect_xxx/Book î‚° î‚  master â— î‚° bundle exec fastlane add_plugin pgyer
[âœ”] ğŸš€
+-----------------------+---------+--------+
|               Used plugins               |
+-----------------------+---------+--------+
| Plugin                | Version | Action |
+-----------------------+---------+--------+
| fastlane-plugin-pgyer | 0.2.2   | pgyer  |
+-----------------------+---------+--------+

[02:51:38]: Make sure to commit your Gemfile, Gemfile.lock and Pluginfile to version control
Installing plugin dependencies...
Successfully installed plugins
```

- 1) æ‰§è¡Œ **å®‰è£… plugin**, å¹¶ä¸ä¼š **ä¸‹è½½ plugin rubyæ–‡ä»¶** åˆ°æœ¬åœ°ç›®å½•
- 2) è€Œæ˜¯ ä¿®æ”¹ **fastlane/Pluginfile** . æ·»åŠ å¯¹ **å‘å¸ƒ** åˆ° **fastlane plugin repo** ä¸­çš„ plugin çš„ **å¼•ç”¨**

### 4. fastlane add_plugin æ‰§è¡Œå®Œæ¯•åçš„ ç›®å½•ç»“æ„

```
âœ  Book ls -l
total 16
drwxr-xr-x  10 xiongzenghui  staff   320  7 29 13:56 Book
drwxr-xr-x@  5 xiongzenghui  staff   160  7 29 12:57 Book.xcodeproj
-rw-r--r--   1 root          staff   178  7 29 17:16 Gemfile
-rw-r--r--   1 root          staff  4002  7 29 17:16 Gemfile.lock
drwxr-xr-x   5 root          staff   160  7 29 17:16 fastlane
âœ  Book 
```

```
âœ  Book tree fastlane
fastlane
â”œâ”€â”€ Appfile
â”œâ”€â”€ Fastfile
â””â”€â”€ Pluginfile

0 directories, 3 files
âœ  Book
```

ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶:

- 1) Gemfile
- 2) Gemfile.lock
- 3) fastlane/**Pluginfile**

### 5. Book/Gemfile

```ruby
source "https://rubygems.org"
gem "fastlane"

# æ·»åŠ å¯¹ ./fastlane/Pluginfile æ–‡ä»¶çš„å¼•ç”¨
plugins_path = File.join(File.dirname(__FILE__), 'fastlane', 'Pluginfile')
eval_gemfile(plugins_path) if File.exist?(plugins_path)
```

### 6. Book/fastlane/Pluginfile

```ruby
# Autogenerated by fastlane
#
# Ensure this file is checked in to source control!

# è®°å½•è¢«å®‰è£…çš„ fastlane plugin æ’ä»¶
gem 'fastlane-plugin-pgyer'
```

æ‰€æœ‰æ‰§è¡Œ**fastlane add_plugin**å®‰è£…çš„pluginï¼Œéƒ½è¢«**è®°å½•**åœ¨è¿™ä¸ªrubyæ–‡ä»¶ä¸­ã€‚

### 7. Fastfile è°ƒç”¨ plugin

```ruby
default_platform :ios

platform :ios do
before_all do
  # ENV["SLACK_URL"] = "https://hooks.slack.com/services/..."
  cocoapods(use_bundle_exec: false)
end

desc " lane æè¿°ä¿¡æ¯:é€šè¿‡è’²å…¬è‹± fastlane æ’ä»¶å®ç°ä¸Šä¼  APP åˆ°è’²å…¬è‹±"
lane :beta do
  # 1ã€è‡ªåŠ¨æ„å»ºiOSé¡¹ç›®ï¼Œæ‰“åŒ…ç­¾åæ„å»ºå¯¼å‡ºä¸ºipa
  gym(
    scheme:"xxx",
    workspace: "xxx.xcworkspace",
    export_method: "ad-hoc"
  )
  
  ################################################
  # 2ã€è°ƒç”¨ è’²å…¬è‹± fastlane plugn
  pgyer(
    api_key: "ä»è’²å…¬è‹±é¡¹ç›®è¯¦æƒ…ä¸­è·å–çš„ apikey",
    user_key: "ä»è’²å…¬è‹±é¡¹ç›®è¯¦æƒ…ä¸­è·å–çš„ userkey",
    update_description: "æœ¬æ¬¡æµ‹è¯•æ›´æ–°çš„æ–‡å­—è¯´æ˜"
  )
  ################################################
end
```

### 8. æ‰§è¡Œ fastlane å‘½ä»¤

```
âœ  Book fastlane beta
```

è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼  APP åˆ°è’²å…¬è‹±ã€‚

### 9. æˆåŠŸå±•ç¤ºä¿¡æ¯

```
[11:23:58]: Successfully exported and compressed dSYM file
# æˆåŠŸæ‰“åŒ…
[11:23:58]: Successfully exported and signed the ipa file:
[11:23:58]: /Users/xxxx/Documents/ComponyProject/xxx/xxx/trunk/xxx/xxx.ipa
[11:23:58]: -------------------
[11:23:58]: --- Step: pgyer ---
[11:23:58]: -------------------
[11:23:58]: The pgyer plugin is working.
[11:23:58]: build_file: /Users/xxx/Documents/ComponyProject/xxx/xxxx/trunk/xxxx/xxx.ipa
[11:23:58]: Start upload /Users/xxx/Documents/ComponyProject/xxx/xxx/trunk/xxx/xxx.ipa to pgyer...
# æˆåŠŸä¸Šä¼ åˆ°è’²å…¬è‹±ï¼Œæ‰“å¼€ä¸‹è½½è¿æ¥æŸ¥çœ‹
[11:24:02]: Upload success. Visit this URL to see: https://www.pgyer.com/xxxx

+------+---------------------+-------------+
|             fastlane summary             |
+------+---------------------+-------------+
| Step | Action              | Time (in s) |
+------+---------------------+-------------+
| 1    | Verifying required  | 0           |
|      | fastlane version    |             |
| 2    | default_platform    | 0           |
| 3    | cocoapods           | 4           |
| 4    | gym                 | 148         |
| 5    | pgyer               | 4           |
+------+---------------------+-------------+

[11:24:02]: fastlane.tools finished successfully ğŸ‰
```

