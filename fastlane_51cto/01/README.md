[TOC]



## 1. fastlane æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆï¼Ÿ

- å½“ä½ æŸ¥çœ‹è¿™ç¯‡æ–‡ç« æ—¶å€™ï¼Œæˆ‘å‡è®¾ä½ æ˜¯ä¸€ä¸ª **ruby ç†Ÿç»ƒè€…/ruby gem å¼€å‘è€…/iOS CI å¼€å‘è€…**

- å¦‚æœä¸æ˜¯ï¼Œå¯ä»¥é—¨å£å³è½¬



## 2. fastlane ä¸‰ä¸ªå¹³å°ä¸‹ åˆå§‹åŒ–

![](03.png)

å…·ä½“ iOS/Android/CoressPlatform å®‰è£… init è‡ªå·±æŸ¥çœ‹æ–‡æ¡£.



## 3. Fastfile ä¸­çš„ ==lane==

### 1. lane()

```ruby
# @param lane_name: å”¯ä¸€çš„åå­—
# @param block: å›è°ƒblockå—ä»£ç 
def lane(lane_name, block)
	....
end
```

### 2. Fastfile ä¸­å®šä¹‰ lane

```ruby
lane :lan1 do
  # å›è°ƒä»£ç å—ä¸­è°ƒç”¨å…¶ä»–çš„actionè®¾ç½®å‡½æ•°
end

lane :lan2 do |options|
  # å›è°ƒä»£sç å—ä¸­è°ƒç”¨å…¶ä»–çš„actionè®¾ç½®å‡½æ•°
end
```

### 3. lane æ¥æ”¶ ==å‚æ•°==

#### 1. Fastfile

```ruby
lane :appstore do |options|
  puts options[:version]
  puts options[:build]
end
```

#### 2. bundle exec fastlane <lane> key:value key2:value2

å‘½ä»¤è¡Œä¸­æ‰§è¡Œå®šä¹‰çš„ lane æ—¶, **ä¼ é€’** å‚æ•°é”®å€¼å¯¹

```
$ fastlane appstore version:2.4.0 build:2.0
```

### 4. lane ä¹‹é—´ ==è°ƒç”¨== (Switching lanes)

```ruby
lane :prepare do
  cocoapods
  match
end

lane :adhoc do
  Â·Â·Â·
end

lane :appstore do
  Â·Â·Â·
end

desc 'fastlane build'  'fastlane build type:adhoc'
lane :build do |options|
  # 1ã€ç›´æ¥å¯è°ƒç”¨ä¸Šé¢çš„ã€prepare laneã€‘
  prepare

  # 2ã€æ ¹æ®å‘½ä»¤è¡Œæ‰§è¡Œ fastlane build type=xxx çš„å€¼æ¥è°ƒç”¨ä¸åŒçš„lane
  case options[:type]
  when 'adhoc'
    adhoc # è°ƒç”¨ä¸Šé¢çš„ prepare lane
  else
    appstore # è°ƒç”¨ä¸Šé¢çš„ prepare lane
  end
end
```

### 5. lane ä¹‹é—´ ==è¿”å›å€¼==

```ruby
lane :deploy do |options|
  value = calculate(value: 3)
  puts value # => 5
end

lane :calculate do |options|
  # ...
  2 + options[:value] # the last line will always be the return value
end
```

### 6. Stop executing a lane

```ruby
lane :build do |options|
  if cached_build_available?
    UI.important 'Skipping build because a cached build is available!'
    next # skip doing the rest of this lane
  end
  match
  gym
end

private_lane :cached_build_available? do |options|
  # ...
  true
end
```

### 7. Lane ==Context== Properties

```ruby
require 'pp'

lane :lan do
  pp lane_context

  # lane_context[SharedValues::BUILD_NUMBER]                # Generated by `increment_build_number`
  # lane_context[SharedValues::VERSION_NUMBER]              # Generated by `increment_version_number`
  # lane_context[SharedValues::SNAPSHOT_SCREENSHOTS_PATH]   # Generated by _snapshot_
  # lane_context[SharedValues::PRODUCE_APPLE_ID]            # The Apple ID of the newly created app
  # lane_context[SharedValues::IPA_OUTPUT_PATH]             # Generated by _gym_
  # lane_context[SharedValues::DSYM_OUTPUT_PATH]            # Generated by _gym_
  # lane_context[SharedValues::SIGH_PROFILE_PATH]           # Generated by _sigh_
  # lane_context[SharedValues::SIGH_UDID]                   # The UDID of the generated provisioning profile
  # lane_context[SharedValues::HOCKEY_DOWNLOAD_LINK]        # Generated by `hockey`
  # lane_context[SharedValues::GRADLE_APK_OUTPUT_PATH]      # Generated by `gradle`
  # lane_context[SharedValues::GRADLE_ALL_APK_OUTPUT_PATHS] # Generated by `gradle`
  # lane_context[SharedValues::GRADLE_FLAVOR]               # Generated by `gradle`
  # lane_context[SharedValues::GRADLE_BUILD_TYPE]           # Generated by `gradle`
end
```

### 8. ENV

```ruby
lane :lan do
  ENV["FASTLANE_PLATFORM_NAME"]
  ENV["FASTLANE_LANE_NAME"]
end
```

### 9. ==Private== lane

```ruby
lane :production do
  # ...
  build(release: true)
  appstore # Deploy to the AppStore
  # ...
end

lane :beta do
  # ...
  build(release: false)
  crashlytics # Distribute to testers
  # ...
end

private_lane :build do |options|
  # ...
end
```

- 1) production => build
- 2) beta => build

### 10. configuration

#### 1. ==Appfile== é»˜è®¤é…ç½®

```
app_identifier "com.used.id"
app_identifier "com.ignored.id"
```

#### 2. ==Fastfile== lane/platform å•ç‹¬é…ç½®

```ruby
for_lane :enterprise do
  app_identifier "com.forlane.enterprise"
end

for_platform :mac do
  app_identifier "com.forplatform.mac"

  for_lane :release do
    app_identifier "com.forplatform.mac.forlane.release"
  end
end
```

#### 3. language é…ç½®

```ruby
locales ['en-US', 'fr-FR', 'ja-JP']

for_lane :screenshots_english_only do
  locales ['en-US']
end

for_lane :screenshots_french_only do
  locales ['fr-FR']
end
```



## 4. eg: Fastfile æ„å»ºä¼ä¸š ipa æµç¨‹

### 1. fastlane/Fastfile

```ruby
desc "æ‰“åŒ…æˆä¼ä¸šç‰ˆipa"
lane :inhouse do |options|
  # 1.
  update_info_plist(
    plist_path: "GoodFolks/info.plist",
    display_name: "æ–°Appåå­—",
  )

  # 2. æ›´æ–°urlType å…·ä½“ç”¨æ³•æŸ¥è¯¢actionæ–‡ä»¶update_info_plistçš„è¯´æ˜
  update_info_plist(
    xcodeproj: "GoodFolks.xcodeproj",
    plist_path: "GoodFolks/info.plist",
    block: lambda { |plist|
      urlScheme = plist["CFBundleURLTypes"].find{|scheme| scheme["CFBundleURLName"] == "weixin"}
      urlScheme[:CFBundleURLSchemes] = ENV["app_urlschems_weixin"]
    }
  )

  # 3. è®¾ç½®ç‰ˆæœ¬å·
  increment_version_number(
    version_number: ENV["app_versionName"]
  )

  # 4. è®¾ç½®buildå·ï¼Œè¿™äº›éƒ½å¯ä»¥å†™æ­»ï¼Œä¹Ÿå¯ä»¥ä¸è¦è¿™äº›actionï¼Œä¹Ÿå¯ä»¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–å€¼
  increment_build_number(
    build_number: ENV["app_versionCode"]
  )

  # 5. ä¸‹è½½å’Œå®‰è£…åŒ¹é…çš„Provision Profileæ–‡ä»¶çš„fastlane action
  # ä¸ç”¨ä½ å»ç®¡é‚£äº›è¯ä¹¦ä¸åŒ¹é…çš„äº‹æƒ…å•¦ï¼Œä¸‹è½½çš„æ–‡ä»¶ä¼šå­˜åœ¨é¡¹ç›®æ ¹ç›®å½•çš„buildæ–‡ä»¶å¤¹ä¸‹
  cert(output_path:"build")

  # 6. ç­¾å
  sigh(
    app_identifier: ENV["app_applicationId"],
    team_id:"9M8CTWAV8P",
    output_path: "build"
  )

  # 7. æœ€åå°±æ˜¯æ‰“åŒ…ï¼Œä¼ä¸šç‰ˆæ‰“åŒ…ï¼Œæ‰“åŒ…å®Œæˆåä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•çš„buildæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆipaæ–‡ä»¶
  gym(
    scheme: "GoodFolks",
    export_method: "enterprise",
    output_directory: "build",
    include_bitcode: false
  )
end
```

### 2. fastlane/ åŒçº§ç›®å½•ä¸‹æ‰§è¡Œå³å¯

```
fastlane inhouse
```

æ³¨æ„ï¼šå¦‚ä¸Šä»£ç ä¸ä¸€å®šä¼šæ­£å¸¸è¿è¡Œï¼Œæ˜¯æˆ‘å¾ˆä¹…ä»¥å‰çš„ fastlane ç‰ˆæœ¬å†™çš„ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºå‚è€ƒæ‹¿å»ä¿®ä¿®æ”¹æ”¹å°±å¯ä»¥ç”¨.



## 5. lane ==hooks==

### 1. before each/allã€after each/allã€error

```ruby
before_all do |lane, options|
  # ...
end

before_each do |lane, options|
  # ...
end

after_all do |lane, options|
  # ...
end

after_each do |lane, options|
  # ...
end

error do |lane, exception, options|
  if options[:debug]
    puts "Hi :)"
  end
end
```

### 2. ç¤ºä¾‹

#### 1. Fastfile

```ruby
error do |lane, exception, options|
  UI.message("---------------- [error] #{lane} (#{lane.class})")
end

before_each do |lane, options|
  UI.message("---------------- [before_each] #{lane} (#{lane.class})")
end

before_all do |lane, options|
  UI.message("---------------- [before_all] #{lane} (#{lane.class})")
end

after_all do |lane, options|
  UI.message("---------------- [after_all] #{lane} (#{lane.class})")
end

after_each do |lane, options|
  UI.message("---------------- [after_each] #{lane} (#{lane.class})")
end

lane :test1 do
end

lane :test2 do
end

lane :test3 do
  my_action
end

lane :test do
  test1
  test2
  test3
end
```

#### 2. bundle exec fastlane test

```
 ~/WORKSPACE/toolbox î‚° î‚  master î‚° bundle exec fastlane test
[âœ”] ğŸš€

[17:01:07]: ------------------------------
[17:01:07]: --- Step: default_platform ---
[17:01:07]: ------------------------------
[17:01:07]: ------------------------------
[17:01:07]: --- Step: default_platform ---
[17:01:07]: ------------------------------
[17:01:07]: Driving the lane 'test' ğŸš€
[17:01:07]: ---------------- [before_all] test (Symbol)
[17:01:07]: ---------------- [before_each] test (Symbol)
[17:01:07]: ---------------- [before_each] test1 (Symbol)
[17:01:07]: ----------------------------------
[17:01:07]: --- Step: Switch to test1 lane ---
[17:01:07]: ----------------------------------
[17:01:07]: Cruising over to lane 'test1' ğŸš–
[17:01:07]: ---------------- [after_each] test1 (Symbol)
[17:01:07]: Cruising back to lane 'test' ğŸš˜
[17:01:07]: ---------------- [before_each] test2 (Symbol)
[17:01:07]: ----------------------------------
[17:01:07]: --- Step: Switch to test2 lane ---
[17:01:07]: ----------------------------------
[17:01:07]: Cruising over to lane 'test2' ğŸš–
[17:01:07]: ---------------- [after_each] test2 (Symbol)
[17:01:07]: Cruising back to lane 'test' ğŸš˜
[17:01:07]: ---------------- [before_each] test3 (Symbol)
[17:01:07]: ----------------------------------
[17:01:07]: --- Step: Switch to test3 lane ---
[17:01:07]: ----------------------------------
[17:01:07]: Cruising over to lane 'test3' ğŸš–
[17:01:07]: ----------------
[17:01:07]: --- Step: my ---
[17:01:07]: ----------------
[17:01:07]: my_action: /Users/xiongzenghui/WORKSPACE/toolbox
[17:01:07]: ---------------- [after_each] test3 (Symbol)
[17:01:07]: Cruising back to lane 'test' ğŸš˜
[17:01:07]: ---------------- [after_each] test (Symbol)
[17:01:07]: ---------------- [after_all] test (Symbol)

+------+----------------------+-------------+
|             fastlane summary              |
+------+----------------------+-------------+
| Step | Action               | Time (in s) |
+------+----------------------+-------------+
| 1    | default_platform     | 0           |
| 2    | default_platform     | 0           |
| 3    | Switch to test1 lane | 0           |
| 4    | Switch to test2 lane | 0           |
| 5    | Switch to test3 lane | 0           |
| 6    | my                   | 0           |
+------+----------------------+-------------+

[17:01:07]: fastlane.tools finished successfully ğŸ‰
```

ä¸»è¦å…³æ³¨ **lane , action , plugin** çŠ¶æ€æ”¹å˜ hook æ‰“å°ä¿¡æ¯:

```
[17:01:07]: ---------------- [before_all] test (Symbol)
[17:01:07]: ---------------- [before_each] test (Symbol)
[17:01:07]: ---------------- [before_each] test1 (Symbol)
[17:01:07]: ---------------- [after_each] test1 (Symbol)
[17:01:07]: ---------------- [before_each] test2 (Symbol)
[17:01:07]: ---------------- [after_each] test2 (Symbol)
[17:01:07]: ---------------- [before_each] test3 (Symbol)
[17:01:07]: ---------------- [after_each] test3 (Symbol)
[17:01:07]: ---------------- [after_each] test (Symbol)
[17:01:07]: ---------------- [after_all] test (Symbol)
```



## 6. fastlane_require() æ›¿ä»£ require() è½½å…¥ ==ç¬¬ä¸‰æ–¹ gem==

### 1. åªæ˜¯åœ¨ ==Fastfile== ä¸­ä½¿ç”¨ fastlane_require()

- 1) If you're using a **third party gem** in your **Fastfile**

- 2) it is **recommended** to use **fastlane_require** instead of **require**

- 3) **fastlane_require** will: (å¥½å¤„)
  - 1) **Verify** the **gem** is **installed**
  - 2) **Show** installation instructions **if not installed**
  - 3) **Require** the gem (**like require** does)

æ¯”å¦‚å¦‚æœéœ€è¦åœ¨ä½ çš„ Fastfile ä¸­ä½¿ç”¨ **hike** è¿™ä¸ª gem , å°±è¿™æ ·å†™:

```ruby
fastlane_require 'hike'

lane :release do
  # Do stuff with hike
end
```

### 2. action/plugin ä¸­ä»ç„¶ä½¿ç”¨ require()

```c
module Fastlane
  module Actions
    module SharedValues
      GITLAB_MR_ADD_NOTE_CUSTOM_VALUE = :GITLAB_MR_ADD_NOTE_CUSTOM_VALUE
    end

    # fastlane_require 'gitlab' #=> é”™è¯¯
    require 'gitlab' #=> æ­£ç¡®

    class GitlabMrAddNoteAction < Action
      ......
    end
  end
end
```



## 7. Fastfile ä»£ç å°è£…

### 1. å¦‚æœå…¨éƒ¨å †ç§¯åœ¨ Fastfile ä¸€ä¸ªæ–‡ä»¶å†…, ä¼šé€ æˆä»£ç çˆ†ç‚¸

> xx/fastlane/Fastfile

```ruby
def func1
  ......
end

def func2
  ......
end

......

def funcN
  ......
end

lane :entry do
  action1
  action2
  .......
  actionN

  plugin1
  plugin2
  .......
  pluginN

  func1
  func2
  .......
  funcN
end
```

å¾ˆå¤šå®šä¹‰åœ¨ Fastfile æ–‡ä»¶å†…çš„ **æ–¹æ³•** åªèƒ½é€šè¿‡ **æ‹·è´** åˆ°å…¶ä»–çš„ Fastfile æ–‡ä»¶ä¸­ä½¿ç”¨.

### 2. fastlane é¡¹ç›®ç»“æ„

#### 1. WORKSPACE/toolbox/ ç›®å½•

```
 ~/WORKSPACE/toolbox î‚° î‚  master â— î‚° ll
-rw-r--r--   1 xiongzenghui  staff   1.2K  7 11 15:06 Gemfile
-rw-r--r--   1 xiongzenghui  staff   8.1K  7 15 18:02 Gemfile.lock
-rw-r--r--   1 xiongzenghui  staff   362B  7 11 14:54 Makefile
-rw-r--r--   1 xiongzenghui  staff   1.2K  7 15 17:00 README.md
drwxr-xr-x  12 xiongzenghui  staff   384B  7 15 23:29 fastlane
```

#### 2. WORKSPACE/toolbox/fastlane/ ç›®å½•

```
 ~/WORKSPACE/toolbox/fastlane î‚° î‚  master â— î‚° ll
-rw-r--r--   1 xiongzenghui  staff   230B  7 11 13:05 Appfile
-rw-r--r--   1 xiongzenghui  staff   2.7K  7 15 23:55 Fastfile
drwxr-xr-x  13 xiongzenghui  staff   416B  7 15 16:26 actions
drwxr-xr-x   6 xiongzenghui  staff   192B  7 15 23:56 helper
```

#### 3. WORKSPACE/toolbox/fastlane/helper

```
 ~/WORKSPACE/toolbox/fastlane/helper î‚° î‚  master â— î‚° ll
total 32
-rw-r--r--  1 xiongzenghui  staff    53B  7 15 23:56 cry.rb
-rw-r--r--  1 xiongzenghui  staff    53B  7 15 23:49 eat.rb
-rw-r--r--  1 xiongzenghui  staff    53B  7 15 23:50 walk.rb
```

### 3. ä½¿ç”¨ ==lane== å°è£…å¯é‡ç”¨ä»£ç 

#### 1. WORKSPACE/toolbox/fastlane/helper/eat.rb

```ruby
lane :eat do
  UI.message("[lane] [eat] .......")
end
```

#### 2. WORKSPACE/toolbox/fastlane/helper/walk.rb

```ruby
lane :run do
  UI.message("[lane] [walk] .......")
end
```

#### 3. WORKSPACE/toolbox/fastlane/helper/cry.rb

```ruby
lane :cry do
  UI.message("[lane] [cry] .......")
end
```

#### 4. WORKSPACE/toolbox/fastlane/Fastfile

```ruby
import 'helper/eat.rb'
import 'helper/walk.rb'
import 'helper/cry.rb'

lane :test do
  eat
  walk
  cry
end
```

#### 5. bundle exec fastlane test

```ruby
 ~/WORKSPACE/toolbox î‚° î‚  master â— î‚° bundle exec fastlane test
[âœ”] ğŸš€

[00:02:43]: Driving the lane 'test' ğŸš€
[00:02:43]: --------------------------------
[00:02:43]: --- Step: Switch to eat lane ---
[00:02:43]: --------------------------------
[00:02:43]: Cruising over to lane 'eat' ğŸš–
[00:02:43]: [lane] [eat] .......
[00:02:43]: Cruising back to lane 'test' ğŸš˜
[00:02:43]: ---------------------------------
[00:02:43]: --- Step: Switch to walk lane ---
[00:02:43]: ---------------------------------
[00:02:43]: Cruising over to lane 'walk' ğŸš–
[00:02:43]: [lane] [walk] .......
[00:02:43]: Cruising back to lane 'test' ğŸš˜
[00:02:43]: --------------------------------
[00:02:43]: --- Step: Switch to cry lane ---
[00:02:43]: --------------------------------
[00:02:43]: Cruising over to lane 'cry' ğŸš–
[00:02:43]: [lane] [cry] .......
[00:02:43]: Cruising back to lane 'test' ğŸš˜

+------+---------------------+-------------+
|             fastlane summary             |
+------+---------------------+-------------+
| Step | Action              | Time (in s) |
+------+---------------------+-------------+
| 1    | Switch to eat lane  | 0           |
| 2    | Switch to walk lane | 0           |
| 3    | Switch to cry lane  | 0           |
+------+---------------------+-------------+

[00:02:43]: fastlane.tools finished successfully ğŸ‰
```

- 1) Driving the lane '**test**'
- 2) Step: Switch to **eat** lane
- 3) Step: Switch to **walk** lane
- 4) Step: Switch to **cry** lane

#### 6. ==ä¸èƒ½ä½¿ç”¨== è¿™ç§æ–¹å¼

- è™½ç„¶å¯ä»¥åœ¨ lane ä¸­, ç›´æ¥ä½¿ç”¨ fastlane UI.messageã€UI.success â€¦. ç­‰æ–¹æ³•.
- ä½†æ˜¯ä¼šå¯¼è‡´ **lane é‡å¤å®šä¹‰**

```
 ~/WORKSPACE/toolbox  bundle exec fastlane test
[âœ”] ğŸš€

[15:35:00]: ------------------------------
[15:35:00]: --- Step: default_platform ---
[15:35:00]: ------------------------------

[!] Lane 'demo' was defined multiple times!
```

### 4. ä½¿ç”¨ ==action (å…¶ä»–ç›®å½•ä¸‹)== å°è£…å¯é‡ç”¨ä»£ç 

#### 1. WORKSPACE/toolbox/fastlane/helper/eat.rb

```ruby
module Fastlane
  module Actions
    class EatAction < Action
      def self.run(params)
        UI.message("[action] [eat] .......")
      end
    end
  end
end
```

#### 2. WORKSPACE/toolbox/fastlane/helper/walk.rb

```ruby

```

#### 3. WORKSPACE/toolbox/fastlane/helper/cry.rb

```ruby

```

#### 4. WORKSPACE/toolbox/fastlane/Fastfile

```ruby
#import 'helper/eat.rb'

#  åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¯¼å…¥ã€å…¶ä»–ç›®å½•ã€‘ä¸‹çš„ action.rb æ–‡ä»¶
#actions_path '../custom_actions_folder/'
actions_path 'helper/'

lane :test do
  eat
end
```

#### 5. bundle exec fastlane test

```ruby
 ~/WORKSPACE/toolbox î‚° î‚  master â— î‚° bundle exec fastlane test
[âœ”] ğŸš€

[00:21:05]: Driving the lane 'test' ğŸš€
[00:21:05]: --------------------------------
[00:21:05]: --- Step: Switch to eat lane ---
[00:21:05]: --------------------------------
[00:21:05]: Cruising over to lane 'eat' ğŸš–
[00:21:05]: Cruising back to lane 'test' ğŸš˜

+------+--------------------+-------------+
|            fastlane summary             |
+------+--------------------+-------------+
| Step | Action             | Time (in s) |
+------+--------------------+-------------+
| 1    | Switch to eat lane | 0           |
+------+--------------------+-------------+

[00:21:05]: fastlane.tools finished successfully ğŸ‰
```

#### 6. æ€»ç»“

å‘ç°æœ€ç»ˆæŠŠ action å½“åš **lane** æ‰§è¡Œçš„.

### 5. ä½¿ç”¨ ==Fastlane Helper== å°è£…å¯é‡ç”¨ä»£ç 

#### 1. WORKSPACE/toolbox/fastlane/helper/eat.rb

```ruby
require 'fastlane_core/ui/ui'

module Fastlane
  UI = FastlaneCore::UI unless Fastlane.const_defined?("UI")
  module Helper
    class EatHelper
      def self.show_message
        UI.message("[helper] [eat] .......")
      end
    end
  end
end
```

#### 2. WORKSPACE/toolbox/fastlane/helper/happy.rb

```ruby
require 'fastlane_core/ui/ui'

module Fastlane
  UI = FastlaneCore::UI unless Fastlane.const_defined?("UI")
  module Helper
    class HappyHelper
      def self.show_message
        UI.message("[helper] [happy] .......")
      end
    end
  end
end
```

#### 3. WORKSPACE/toolbox/fastlane/helper/cry.rb

```ruby
require 'fastlane_core/ui/ui'

module Fastlane
  UI = FastlaneCore::UI unless Fastlane.const_defined?("UI")
  module Helper
    class CryHelper
      def self.show_message
        UI.message("[helper] [cry] .......")
      end
    end
  end
end
```

#### 4. WORKSPACE/toolbox/fastlane/Fastfile

```ruby
require_relative 'helper/eat.rb'
require_relative 'helper/happy.rb'
require_relative 'helper/cry.rb'

lane :test do
  Helper::EatHelper::show_message
  # Helper::WalkHelper::show_message
  Helper::HappyHelper::show_message
  Helper::CryHelper::show_message
end
```

#### 5. bundle exec fastlane test

```ruby
 ~/WORKSPACE/toolbox î‚° î‚  master â— î‚° bundle exec fastlane test
[âœ”] ğŸš€

[00:13:45]: Driving the lane 'test' ğŸš€
[00:13:45]: [helper] [eat] .......
[00:13:45]: [helper] [happy] .......
[00:13:45]: [helper] [cry] .......
[00:13:45]: fastlane.tools finished successfully ğŸ‰
```

#### 6. æ€»ç»“

éƒ½æŒ‰ç…§ **helper** æ‰§è¡Œçš„.

### 6. æ€»ç»“

- 1) åº”è¯¥ä½¿ç”¨ **action (æœ¬åœ°)** æˆ–è€… **plugin (è¿œç¨‹)** å°è£…å¯é‡ç”¨çš„ä»£ç 
- 2) action å’Œ plugin **è·¯å¾„** é—®é¢˜
  - **ä¸åº”è¯¥** ä¾èµ–å¤–éƒ¨ **lane** è°ƒç”¨æ—¶çš„ **ç›¸å¯¹è·¯å¾„**
  - è€Œ **åº”è¯¥** ç”±å¤–éƒ¨ **lane** ä¼ å…¥ **ç»å¯¹è·¯å¾„**



## 8. ä»£ç å®šä¹‰ lane

### 1. ç¤ºä¾‹

```ruby
require 'fastlane'

Fastlane::FastFile.new.parse("lane :test do
  UI.message('hello')
end").runner.execute(:test)
```

```
 ~/Desktop î‚° ruby main.rb
[11:15:16]: Driving the lane 'test' ğŸš€
[11:15:16]: hello
```

### 2. fastlane plugin spec

```ruby
require 'spec_helper'
require 'webmock/rspec'

describe Fastlane::Actions::CiBuildNumberAction do
  describe "xxx" do
    it "xxx" do
      ENV['TRAVIS'] = '1'
      ENV['TRAVIS_BUILD_NUMBER'] = '42'

      result = Fastlane::FastFile.new.parse("lane :test do
        ci_build_number
      end").runner.execute(:test)

      expect(result).to eq('42')

      ENV.delete('TRAVIS')
      ENV.delete('TRAVIS_BUILD_NUMBER')
    end
  end
end
```

